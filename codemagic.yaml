workflows:
  ios-kmp:
    name: Build iOS KMP App
    environment:
      xcode: latest
      cocoapods: default
      vars:
        BUNDLE_ID: "org.dsqrwym.pgdm"
        APP_NAME: "PGDM"
    scripts:

      - name: Build iOS framework from shared module
        working_directory: "Front/Plataforma Gestio-n Distribucio-n  Mayorista"
        script: |
          chmod +x ./gradlew
          ./gradlew :shared:syncFramework

      - name: Build iOS app
        working_directory: "Front/Plataforma Gestio-n Distribucio-n  Mayorista"
        script: |
          xcodebuild -project iosApp/iosApp.xcodeproj \
            -scheme iosApp \
            -sdk iphoneos -configuration release archive \
            -archivePath $HOME/build/$APP_NAME.xcarchive

      - name: Export IPA
        working_directory: "Front/Plataforma Gestio-n Distribucio-n  Mayorista"
        script: |
          xcodebuild -exportArchive \
            -archivePath $HOME/build/$APP_NAME.xcarchive \
            -exportOptionsPlist iosApp/exportOptions.plist \
            -exportPath $HOME/build/IPA

    artifacts:
      - build/IPA/*.ipa
